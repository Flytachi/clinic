server {
    server_name __HOSTS__;
    listen __PORT__;
    listen [::]:__PORT__;
    root __ROOT__;
    __ERRORS__

    # Security
    if ($http_user_agent ~* LWP::Simple|BBBike|wget) {return 403;}
    if ($http_user_agent ~* msnbot|scrapbot) {return 403;}
    if ( $http_referer ~* (babes|forsale|girl|jewelry|love|nudit|organic|poker|porn|sex|teen)) {return 403;}

    location ~ (core.x|box|.zip|.key|.cfg|.gitignore)$ {return 404;}
    location /storage/ {
        valid_referers none blocked __HOSTS__;
        if ($invalid_referer) {return 403;}
    }

    location / {
        index index.html index.htm index.php;
        try_files $uri $uri/ @rewrite;
    }

    location ~ \.php$ {
        try_files $fastcgi_script_name = 404;
        include fastcgi_params;

        fastcgi_pass                unix:/run/php/php-fpm.sock;
        fastcgi_index               index.php;
        fastcgi_buffers             8 16k;
        fastcgi_buffer_size         32k;

        fastcgi_param DOCUMENT_ROOT $realpath_root;
        fastcgi_param SCRIPT_FILENAME       $realpath_root$fastcgi_script_name;
        #fastcgi_param PHP_ADMIN_VALUE      "open_basedir=$base/:/usr/lib/php/:/tmp/";
    }

    location @rewrite {
        rewrite ^ $uri.php last;
    }
}